<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>تعديل الوصفة</title>
  <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-auth.js"></script>
</head>
<body>
  <h2>تعديل الوصفة</h2>

  <form id="editRecipeForm">
    <input type="text" id="recipeTitle" placeholder="اسم الوصفة" required />
    <textarea id="recipeDescription" placeholder="وصف الوصفة" required></textarea>
    <input type="url" id="recipeImage" placeholder="رابط صورة الطبق" required />
    <input type="url" id="recipeVideo" placeholder="رابط الفيديو" />
    <button type="submit">حفظ التعديلات</button>
  </form>

  <script type="module">
    import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";
    import { getAuth } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-auth.js";

    const db = getFirestore();
    const auth = getAuth();

    // جلب معرّف الوصفة من الرابط
    const urlParams = new URLSearchParams(window.location.search);
    const recipeId = urlParams.get("recipeId");

    // جلب بيانات الوصفة من قاعدة البيانات
    async function loadRecipe() {
      if (recipeId) {
        const recipeDoc = await getDoc(doc(db, "recipes", recipeId));
        if (recipeDoc.exists()) {
          const recipeData = recipeDoc.data();
          document.getElementById("recipeTitle").value = recipeData.title;
          document.getElementById("recipeDescription").value = recipeData.description;
          document.getElementById("recipeImage").value = recipeData.imageURL;
          document.getElementById("recipeVideo").value = recipeData.videoURL;
        }
      }
    }

    // حفظ التعديلات
    document.getElementById("editRecipeForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      if (recipeId) {
        const title = document.getElementById("recipeTitle").value;
        const description = document.getElementById("recipeDescription").value;
        const imageURL = document.getElementById("recipeImage").value;
        const videoURL = document.getElementById("recipeVideo").value;

        try {
          await updateDoc(doc(db, "recipes", recipeId), {
            title,
            description,
            imageURL,
            videoURL
          });
          alert("تم حفظ التعديلات بنجاح!");
        } catch (error) {
          alert("حدث خطأ أثناء حفظ التعديلات.");
        }
      }
    });

    // تحميل الوصفة عند فتح الصفحة
    window.onload = loadRecipe;
  </script>
</body>
</html>
